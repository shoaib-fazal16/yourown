Ext.namespace('K.kreports.ksnapshot');K.kreports.ksnapshot.bX=new Ext.LoadMask(Ext.getBody(),{msg:bi('LBL_TAKING_SNAPSHOT')});Ext.define('K.kreports.ksnapshot.cN',{extend:'Ext.data.Model',fields:[{name:'snapshot'},{name:'description'}]});K.kreports.ksnapshot.cA=function(){if(document.getElementById('recordid'))return document.getElementById('recordid').value;else{var EditViewForm=document.getElementById('EditView');return EditViewForm.elements.record.value;}};K.kreports.ksnapshot.cJ=new Ext.data.Store({model:K.kreports.ksnapshot.cN,proxy:{type:'ajax',url:'index.php?module=KReports&action=get_snapshots&to_pdf=true&requester='+K.kreports.ksnapshot.cA(),reader:{type:'json'}}});K.kreports.ksnapshot.snapshotCombo=new Ext.form.field.ComboBox({store:K.kreports.ksnapshot.cJ,id:'snapshot_combo',name:'snapshot_combo',displayField:'description',valueField:'snapshot',typeAhead:true,editable:false,value:bi('LBL_CURRENT_SNAPSHOT'),queryMode:'local',triggerAction:'all',selectOnFocus:true,width:135,iconCls:'no-icon',listeners:{'added':function(){K.kreports.ksnapshot.cJ.load();},'select':function(){if(document.getElementById('dynamicoptions').value!=''){if(K.kreports.ksnapshot.snapshotCombo.value==0)K.kreports.DetailView.bH.show();else K.kreports.DetailView.bH.hide();}Ext.getCmp('kReporterPresentation').reloadPresentation(null,K.kreports.ksnapshot.snapshotCombo.value);if(K.kreports.visualizationmanager!=undefined)K.kreports.visualizationmanager.update();}}});K.kreports.ksnapshot.takeSnapshot=function(){K.kreports.ksnapshot.bX.show();Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=take_snapshot',success:function(){K.kreports.ksnapshot.bX.hide();K.kreports.ksnapshot.cJ.load();},failure:function(){K.kreports.ksnapshot.bX.hide();K.kreports.ksnapshot.cJ.load();},params:{record:document.getElementById('recordid').value}});};K.kreports.ksnapshot.dR=new Ext.grid.Panel({title:'Snapshots',store:K.kreports.ksnapshot.cJ,columns:[{text:bi('LBL_KSNAPSHOT'),dataIndex:'description',flex:1}],height:200,sm:new Ext.selection.RowModel(),tbar:[{text:bi('LBL_DELETE_BUTTON_LABEL'),icon:'modules/KReports/images/delete.png',handler:function(){K.kreports.ksnapshot.dR.getSelectionModel().getSelection().forEach(function(cE){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=delete_snaphot',success:function(){K.kreports.ksnapshot.cJ.remove(cE);},params:{record:K.kreports.ksnapshot.cA(),snapshotid:cE.get('snapshot')}});});}}]});K.kreports.ksnapshot.snapshotPanel=new Ext.panel.Panel({bodyPadding:5,pluginid:'ksnapshots',title:bi('LBL_KSNAPSHOTS'),items:[K.kreports.ksnapshot.dR],setPanelData:function(pluginParams){},getPanelData:function(){},listeners:{add:function(){K.kreports.ksnapshot.cJ.load({params:{withoutActual:true}});}}}); 